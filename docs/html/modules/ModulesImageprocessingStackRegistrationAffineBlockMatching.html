---
layout: default
---

<head>
    <link rel="stylesheet" href="../../css/index.css">
</head>

<body>
<!-- Side navigation -->
<div class="sidenav">
    <a href="../../index.html" class="nav1">Introduction</a>
    <a href="../gettingstarted.html" class="nav1">Getting started</a>
    <a href="../modulelist.html" class="nav1">Modules</a>
    <a href="../macrolist.html" class="nav1">Macros</a>
    <!-- <a href="../extendingmia.html" class="nav1">Extending MIA</a> -->
</div>

<!-- Page content -->
<div class="main">
    <!--The following is replaced automatically by the generated module list-->
    <a href="../modulelist.html">Back to module list</a>
<h1>Affine (block matching)</h1>
<h2>Description</h2>
Apply slice-by-slice (2D) affine-based image registration to a multi-dimensional stack.  Images can be aligned relative to the first frame in the stack, the previous frame or a separate image in the workspace.  The registration transform can also be calculated from a separate stack to the one that it will be applied to.  Registration can be performed along either the time or Z axes.  The non-registered axis (e.g. time axis when registering in Z) can be "linked" (all frames given the same registration) or "independent" (each stack registered separately).<br><br>This module uses the <a href="https://github.com/fiji/blockmatching">Block Matching</a> plugin and associated MPICBG tools to detect matching regions from the input images and calculate and apply the necessary 2D affine transforms.
<h2>Parameters</h2>
<ul><li><b>Input image</b> (default = "") Image from workspace to apply registration to.</li><br><li><b>Apply to input image</b> (default = "true") When selected, the post-operation image will overwrite the input image in the workspace.  Otherwise, the image will be saved to the workspace with the name specified by the "Output image" parameter.</li><br><li><b>Output image</b> (default = "") If "Apply to input image" is not selected, the post-operation image will be saved to the workspace with this name.</li><br><li><b>Registration axis</b> (default = "Time") Controls which stack axis the registration will be applied in.  For example, when "Time" is selected, all images along the time axis will be aligned.  Choices are: Time, Z.</li><br><li><b>Other axis mode</b> (default = "Independent") For stacks with non-registration axis lengths longer than 1 (e.g. the "Z" axis when registering in time) the behaviour of this other axis is controlled by this parameter:<br><ul><li>"Independent" Each non-registration axis is registered independently.  For example, applying separate Z-registrations for each timepoint of a 4D stack.</li><li>"Linked" All elements of the non-registration axis are registered with a single transform.  For example, applying the same registration at a timepoint to all slices of a 4D stack.</li></ul></li><br><li><b>Fill mode</b> (default = "Black") Controls what intensity any border pixels will have.  "Borders" in this case correspond to strips/wedges at the image edge corresponding to regions outside the initial image (e.g. the right-side of an output image when the input was translated to the left).   Choices are: Black, White.</li><br><li><b>Enable multithreading</b> (default = "true") When selected, certain parts of the registration process will be run on multiple threads of the CPU.  This can provide a speed improvement when working on a computer with a multi-core CPU.</li><br><li><b>Reference mode</b> (default = "First frame") </li><br><li><b>Number of previous frames</b> (default = "1") </li><br><li><b>Previous frames statistic</b> (default = "Maximum") </li><br><li><b>Reference image</b> (default = "") </li><br><li><b>Calculation source</b> (default = "Internal") </li><br><li><b>External source</b> (default = "") </li><br><li><b>Calculation channel</b> (default = "1") </li><br><li><b>Show detected points</b> (default = "false") </li><br><li><b>Transformation mode</b> (default = "Rigid (trans., rot.)") Controls the type of registration being applied:<br><ul><li>"Affine (trans., rot., scale, shear)" Applies the full affine transformation, whereby the input image can undergo translation, rotation, reflection, scaling and shear.</li><li>"Rigid (trans., rot.)" Applies only translation and rotation to the input image.  As such, all features should remain the same size.</li><li>"Similarity (trans., rot., iso-scale)" Applies translation, rotating and linear scaling to the input image.</li><li>"Translation" Applies only translation (motion within the 2D plane) to the input image.</li></ul></li><br><li><b>Layer scale</b> (default = "1.0") </li><br><li><b>Search radius (px)</b> (default = "50") </li><br><li><b>Block radius (px)</b> (default = "50") </li><br><li><b>Resolution</b> (default = "24") </li><br><li><b>Minimal PMCC r</b> (default = "0.1") </li><br><li><b>Maximal curvature ratio</b> (default = "1000.0") </li><br><li><b>Closest/next closest ratio</b> (default = "1.0") "Correspondence candidates from local descriptor matching are accepted only if the Euclidean distance to the nearest neighbour is significantly smaller than that to the next nearest neighbour. Lowe (2004) suggests a ratio of r=0.8 which requires some increase when matching things that appear significantly distorted.".  Description taken from <a href="https://imagej.net/Feature_Extraction">https://imagej.net/Feature_Extraction</a></li><br><li><b>Local region sigma</b> (default = "65.0") </li><br><li><b>Maximal absolute local displacement (px)</b> (default = "12.0") </li><br><li><b>Maximal relative local displacement (px)</b> (default = "3.0") </li><br></ul>

</div>
</body>